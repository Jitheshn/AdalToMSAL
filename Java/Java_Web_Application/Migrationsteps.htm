<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:0cm;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 72.0pt 72.0pt 72.0pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-IN link=blue vlink="#954F72" style='word-wrap:break-word'>

<div class=WordSection1>

<ul style='margin-top:0cm' type=circle>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'><b>&lt;Projectfolder&gt;\pom.xml</b></li>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:54.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Replace adal package with msal </li>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>update version of oauth2-oidc-sdk package</li>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Add the package commons-lang3</li>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:135.0pt;line-height:normal'>&nbsp;</p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 title=""
 summary="" style='margin-left:132.0pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=372 valign=top style='width:279.0pt;border:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>ADAL</p>
  </td>
  <td width=412 valign=top style='width:309.1pt;border:solid #A3A3A3 1.0pt;
  border-left:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>MSAL</p>
  </td>
 </tr>
 <tr>
  <td width=372 valign=top style='width:279.0pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;dependency&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;groupId&gt;com.microsoft.azure&lt;/groupId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;artifactId&gt;adal4j&lt;/artifactId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;version&gt;1.6.0&lt;/version&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/dependency&gt;</p>
  </td>
  <td width=412 valign=top style='width:309.1pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;dependency&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;groupId&gt;com.microsoft.azure&lt;/groupId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;artifactId&gt;msal4j&lt;/artifactId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;version&gt;1.13.4&lt;/version&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/dependency&gt;</p>
  </td>
 </tr>
 <tr>
  <td width=372 valign=top style='width:279.0pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;dependency&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;groupId&gt;com.nimbusds&lt;/groupId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;artifactId&gt;oauth2-oidc-sdk&lt;/artifactId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;version&gt;5.24.1&lt;/version&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/dependency&gt;</p>
  </td>
  <td width=412 valign=top style='width:309.1pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;dependency&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;groupId&gt;com.nimbusds&lt;/groupId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;artifactId&gt;oauth2-oidc-sdk&lt;/artifactId&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;version&gt;10.5.1&lt;/version&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/dependency&gt;</p>
  </td>
 </tr>
 <tr>
  <td width=372 valign=top style='width:279.0pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  </td>
  <td width=412 valign=top style='width:309.1pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>&lt;dependency&gt;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>       
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>       
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>       
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;3.4&lt;/version&gt;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>   &lt;/dependency&gt;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:54.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=circle>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'><b><u>&lt;Projectfolder&gt;\src\main\java\com\microsoft\aad\adal4jsample\BasicFilter.Java</u></b></li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Remove following imports from adal4j library</li>
  <ul style='margin-top:0cm' type=disc>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.AuthenticationContext;</li>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.AuthenticationException;</li>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.AuthenticationResult;</li>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.ClientCredential;</li>
  </ul>
 </ul>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:189.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Add the MSAL imports</li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import com.microsoft.aad.msal4j.*;</li>
 </ul>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:189.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Make following code changes</li>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:162.0pt;line-height:normal'>&nbsp;</p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 title=""
 summary="" style='margin-left:132.0pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>ADAL</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border:solid #A3A3A3 1.0pt;
  border-left:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>MSAL</p>
  </td>
 </tr>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  boolean isAuthDataExpired(HttpServletRequest httpRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp; &nbsp;
  AuthenticationResult authData = AuthHelper.getAuthSessionObject(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp; &nbsp;
  return authData.getExpiresOnDate().before(new Date()) ? true : false;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>}</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  boolean isAuthDataExpired(HttpServletRequest httpRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp; &nbsp;
  IAuthenticationResult authData =
  AuthHelper.getAuthSessionObject(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp; &nbsp;
  return authData.expiresOnDate().before(new Date()) ? true : false;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>}</p>
  </td>
 </tr>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  String getRedirectUrl(String currentUri, String state, String nonce)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throws UnsupportedEncodingException {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String redirectUrl = authority</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + this.tenant</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>              
  <span style='background:yellow'> + &quot;/oauth2/authorize?</span>response_type=code&amp;<span
  style='background:red'>scope=directory.read.all</span>&amp;response_mode=form_post&amp;redirect_uri=&quot;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + URLEncoder.encode(currentUri, &quot;UTF-8&quot;) +
  &quot;&amp;client_id=&quot;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + clientId + &quot;<span style='background:yellow'>&amp;resource=https%3a%2f%2fgraph.microsoft.com&quot;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + &quot;&amp;state=&quot; + state</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + &quot;&amp;nonce=&quot; + nonce;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return redirectUrl;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  String getRedirectUrl(String currentUri, String state, String nonce)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throws UnsupportedEncodingException {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String redirectUrl = authority</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + this.tenant</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>             
    <span style='background:yellow'>+ &quot;/oauth2/v2.0/authorize?</span>response_type=code&amp;response_mode=form_post&amp;redirect_uri=&quot;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + URLEncoder.encode(currentUri, &quot;UTF-8&quot;) +
  &quot;&amp;client_id=&quot;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + clientId + &quot;<span style='background:yellow'>&amp;scope=https%3a%2f%2fgraph.microsoft.com%2f.default&quot;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>             
    + &quot;&amp;state=&quot; + state</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + &quot;&amp;nonce=&quot; + nonce;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return redirectUrl;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=591 valign=top style='width:443.25pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  updateAuthDataUsingRefreshToken(HttpServletRequest httpRequest) throws
  Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        AuthenticationResult
  authData =</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  getAccessTokenFromRefreshToken(AuthHelper.getAuthSessionObject(httpRequest).<span
  style='background:red'>getRefreshToken()</span>);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  setSessionPrincipal(httpRequest, authData);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=587 valign=top style='width:440.15pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  updateAuthDataUsingRefreshToken(HttpServletRequest httpRequest) throws
  Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  <span style='background:yellow'>IAuthenticationResult</span> authData =  </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>getAccessTokenFromRefreshToken(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  setSessionPrincipal(httpRequest, authData);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=591 valign=top style='width:443.25pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>   public
  void doFilter(ServletRequest request, ServletResponse response,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                        
  FilterChain chain) throws IOException, ServletException {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (request instanceof HttpServletRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletRequest httpRequest = (HttpServletRequest) request;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletResponse httpResponse = (HttpServletResponse) response;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String currentUri = httpRequest.getRequestURL().toString();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String queryStr = httpRequest.getQueryString();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String fullUrl = currentUri + (queryStr != null ? &quot;?&quot; + queryStr :
  &quot;&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  // check if user has a AuthData in the session</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  if (!AuthHelper.isAuthenticated(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  if (AuthHelper.containsAuthenticationData(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                        processAuthenticationData(httpRequest,
  currentUri, fullUrl);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  } else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  // not authenticated</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  sendAuthRedirect(httpRequest, httpResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  return;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                    }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  if (isAuthDataExpired(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  updateAuthDataUsingRefreshToken(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (AuthenticationException authException) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  // something went wrong (like expiration or revocation of token)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  // we should invalidate AuthData stored in session and redirect to
  Authorization server</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  removePrincipalFromSession(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  sendAuthRedirect(httpRequest, httpResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  return;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (Throwable exc) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  httpResponse.setStatus(500);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  request.setAttribute(&quot;error&quot;, exc.getMessage());</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  request.getRequestDispatcher(&quot;/error.jsp&quot;).forward(request,
  response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  chain.doFilter(request, response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=587 valign=top style='width:440.15pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>public void
  doFilter(ServletRequest request, ServletResponse response,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                        
  FilterChain chain) throws IOException, ServletException {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (request instanceof HttpServletRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletRequest httpRequest = (HttpServletRequest) request;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletResponse httpResponse = (HttpServletResponse) response;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String currentUri = httpRequest.getRequestURL().toString();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String queryStr = httpRequest.getQueryString();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String fullUrl = currentUri + (queryStr != null ? &quot;?&quot; + queryStr :
  &quot;&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  // check if user has a AuthData in the session</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  if (!AuthHelper.isAuthenticated(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  if (AuthHelper.containsAuthenticationData(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  processAuthenticationData(httpRequest, currentUri, fullUrl);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                    }
  else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  // not authenticated</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  sendAuthRedirect(httpRequest, httpResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                       
  return;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  if (isAuthDataExpired(httpRequest)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  updateAuthDataUsingRefreshToken(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (<span style='background:yellow'>MsalInteractionRequiredException</span>
  authException) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  // something went wrong (like expiration or revocation of token)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>              
   // we should invalidate AuthData stored in session and redirect to
  Authorization server</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  removePrincipalFromSession(httpRequest);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  sendAuthRedirect(httpRequest, httpResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  return;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (Throwable exc) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  httpResponse.setStatus(500);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  request.setAttribute(&quot;error&quot;, exc.getMessage());</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  request.getRequestDispatcher(&quot;/error.jsp&quot;).forward(request,
  response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        chain.doFilter(request,
  response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=591 valign=top style='width:443.1pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  processAuthenticationData(HttpServletRequest httpRequest, String currentUri,
  String fullUrl)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throws Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        for
  (String key : httpRequest.getParameterMap().keySet()) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  params.put(key, httpRequest.getParameterMap().get(key)[0]);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        //
  validate that state in response equals to state in request</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  StateData stateData = validateState(httpRequest.getSession(),
  params.get(STATE));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  AuthenticationResponse authResponse = AuthenticationResponseParser.parse(new
  URI(fullUrl), params);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (AuthHelper.isAuthenticationSuccessful(authResponse)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  AuthenticationSuccessResponse oidcResponse = (AuthenticationSuccessResponse)
  authResponse;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  // validate that OIDC Auth Response matches Code Flow (contains only
  requested artifacts)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  validateAuthRespMatchesCodeFlow(oidcResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           <span
  style='background:yellow'> AuthenticationResult authData =</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>                   
  getAccessToken(oidcResponse.getAuthorizationCode(), currentUri);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  // validate nonce to prevent reply attacks (code maybe substituted to one
  with broader access)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  validateNonce(stateData, getClaimValueFromIdToken(authData.getIdToken(),
  &quot;nonce&quot;));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  setSessionPrincipal(httpRequest, authData);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  AuthenticationErrorResponse oidcResponse = (AuthenticationErrorResponse)
  authResponse;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw new Exception(String.format(&quot;Request for auth code failed: %s -
  %s&quot;,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  oidcResponse.getErrorObject().getCode(),</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  oidcResponse.getErrorObject().getDescription()));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=594 valign=top style='width:445.3pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  processAuthenticationData(HttpServletRequest httpRequest, String currentUri,
  String fullUrl)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throws Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>Map&lt;String, List&lt;String&gt;&gt; params = new
  HashMap&lt;&gt;();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>        for (String key :
  httpRequest.getParameterMap().keySet()) {</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>           List&lt;String&gt; lst = new
  ArrayList&lt;String&gt;();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>          
  lst.add(httpRequest.getParameterMap().get(key)[0]);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>           params.put(key,lst);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>        }</span>        </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        //
  validate that state in response equals to state in request</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  StateData stateData = validateState(httpRequest.getSession(),
  params.get(STATE)<span style='background:lime'>.get(0))</span>;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  AuthenticationResponse authResponse = AuthenticationResponseParser.parse(new
  URI(fullUrl), params);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (AuthHelper.isAuthenticationSuccessful(authResponse)) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  AuthenticationSuccessResponse oidcResponse = (AuthenticationSuccessResponse)
  authResponse;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  // validate that OIDC Auth Response matches Code Flow (contains only
  requested artifacts)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  validateAuthRespMatchesCodeFlow(oidcResponse);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'><span style='background:yellow'> IAuthenticationResult
  authData =</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>                    getAccessToken(oidcResponse.getAuthorizationCode(),
  currentUri);</span>            </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>// validate
  nonce to prevent reply attacks (code maybe substituted to one with broader
  access)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  validateNonce(stateData, getClaimValueFromIdToken(authData.idToken(), &quot;nonce&quot;));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  setSessionPrincipal(httpRequest, authData);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  AuthenticationErrorResponse oidcResponse = (AuthenticationErrorResponse)
  authResponse;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw new Exception(String.format(&quot;Request for auth code failed: %s -
  %s&quot;,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  oidcResponse.getErrorObject().getCode(),</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  oidcResponse.getErrorObject().getDescription()));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  AuthenticationResult getAccessTokenFromRefreshToken(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            <span
  style='background:yellow'>String refreshToken</span>) throws Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       <span
  style='background:red'> AuthenticationContext context;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>AuthenticationResult result = null;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  ExecutorService service = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>          </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>  </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>service =
  Executors.newFixedThreadPool(1);</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            <span
  style='background:red'>context = new AuthenticationContext(authority + tenant
  + &quot;/&quot;, true,</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:red'>                    service);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'><span style='background:yellow'>Future&lt;AuthenticationResult&gt;
  future = context</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>                   
  .acquireTokenByRefreshToken(refreshToken, new ClientCredential(clientId,
  clientSecret), null, null);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            <span
  style='background:yellow'>result = future.get();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  catch (ExecutionException e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw e.getCause();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  finally {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  service.shutdown();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if (<span
  style='background:yellow'>result</span> == null) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw new ServiceUnavailableException(&quot;authentication result was
  null&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       <span
  style='background:yellow'> return result;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  IAuthenticationResult getAccessTokenFromRefreshToken(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  HttpServletRequest httpRequest) throws Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>      <span
  style='background:yellow'>  IAuthenticationResult result = 
  AuthHelper.getAuthSessionObject(httpRequest);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:lime'>IClientCredential credential =
  ClientCredentialFactory.createFromSecret(clientSecret);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:lime'>IAuthenticationResult updatedResult = null;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  ExecutorService service = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  service = Executors.newFixedThreadPool(1);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            I<span
  style='background:lime'>ConfidentialClientApplication app  =
  ConfidentialClientApplication.builder(clientId, </span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>            credential).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>            authority(authority).</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>            build();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>          <span
  style='background:lime'>  SilentParameters parameters =
  SilentParameters.builder(</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>               
  Collections.singleton(&quot;User.Read&quot;),</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:lime'>                result.account()).build();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           <span
  style='background:yellow'> CompletableFuture&lt;IAuthenticationResult&gt;
  future = app.acquireTokenSilently(parameters);</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'><span
  style='background:yellow'>            updatedResult = future.get();</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  catch (ExecutionException e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw e.getCause();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  finally {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  service.shutdown();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>    if (<span style='background:yellow'>updatedResult</span>
  == null) {</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>            throw new
  ServiceUnavailableException(&quot;authentication result was null&quot;);</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>        </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'><span style='background:yellow'>return
  updatedResult;</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>//Many
  changes </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  AuthenticationResult getAccessToken(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  AuthorizationCode authorizationCode, String currentUri)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            throws
  Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String authCode = authorizationCode.getValue();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>ClientCredential</span> credential = new
  ClientCredential(clientId,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  clientSecret);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>AuthenticationContext</span> context;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>AuthenticationResult</span> result = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  ExecutorService service = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  service = Executors.newFixedThreadPool(1);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  context = new AuthenticationContext(authority + tenant + &quot;/&quot;, true,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  service);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  Future&lt;AuthenticationResult&gt; future = context</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  .acquireTokenByAuthorizationCode(authCode, new URI(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                           
  currentUri), credential, null);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>          </p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>  result = future.get();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  catch (ExecutionException e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw e.getCause();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  finally {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  service.shutdown();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (result == null) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw new ServiceUnavailableException(&quot;authentication result was
  null&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        return
  result;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  IAuthenticationResult getAccessToken(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  AuthorizationCode authorizationCode, String currentUri)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  throws Throwable {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    String
  authCode = authorizationCode.getValue();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    <span
  style='background:yellow'>IClientCredential</span> credential = ClientCredentialFactory.createFromSecret(clientSecret);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    <span
  style='background:yellow'>IConfidentialClientApplication</span> context =
  null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    <span
  style='background:yellow'>IAuthenticationResult</span> result = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>   
  ExecutorService service = null;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  service = Executors.newFixedThreadPool(1);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  context = ConfidentialClientApplication.builder(clientId, </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  credential).</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  authority(authority</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  + this.tenant + &quot;/&quot;).</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  build();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  AuthorizationCodeParameters parameters = AuthorizationCodeParameters.builder(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  authCode,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  new URI(currentUri)).</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                   
  build();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  Future&lt;IAuthenticationResult&gt; future =
  context.acquireToken(parameters);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  result = future.get();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    } catch
  (ExecutionException e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        throw
  e.getCause();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    } finally
  {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  service.shutdown();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    if
  (result == null) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        throw
  new ServiceUnavailableException(&quot;authentication result was null&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    return
  result;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>}</p>
  </td>
 </tr>
 <tr>
  <td width=589 valign=top style='width:441.85pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  setSessionPrincipal(HttpServletRequest httpRequest,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                                    
  <span style='background:yellow'>AuthenticationResult</span> result) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        httpRequest.getSession().setAttribute(AuthHelper.PRINCIPAL_SESSION_NAME,
  result);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=589 valign=top style='width:441.45pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private void
  setSessionPrincipal(HttpServletRequest httpRequest,</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                                   
  <span style='background:yellow'>IAuthenticationResult</span> result) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  httpRequest.getSession().setAttribute(AuthHelper.PRINCIPAL_SESSION_NAME,
  result);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:108.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=circle>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'><b><u>&lt;Projectfolder&gt;\src\main\java\com\microsoft\aad\adal4jsample\AuthHelper.java</u></b></li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Remove below import from adal4j lib</li>
  <ul style='margin-top:0cm' type=disc>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.AuthenticationResult;</li>
  </ul>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Remove the below import from nimbusds lib</li>
  <ul style='margin-top:0cm' type=disc>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import
       com.nimbusds.openid.connect.sdk.AuthenticationResponseParser;</li>
  </ul>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Add following import from msal4j lib</li>
  <ul style='margin-top:0cm' type=disc>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.msal4j.*;</li>
  </ul>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Make following code changes</li>
 </ul>
</ul>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 title=""
 summary="" style='margin-left:132.0pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=597 valign=top style='width:447.5pt;border:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>ADAL</p>
  </td>
  <td width=579 valign=top style='width:434.6pt;border:solid #A3A3A3 1.0pt;
  border-left:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>MSAL</p>
  </td>
 </tr>
 <tr>
  <td width=597 valign=top style='width:447.5pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>public static
  <span style='background:yellow'>AuthenticationResult</span>
  getAuthSessionObject(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletRequest request) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return (AuthenticationResult) request.getSession().getAttribute(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  PRINCIPAL_SESSION_NAME);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=579 valign=top style='width:434.6pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>public static
  <span style='background:yellow'>IAuthenticationResult</span>
  getAuthSessionObject(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  HttpServletRequest request) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return (IAuthenticationResult) request.getSession().getAttribute(</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  PRINCIPAL_SESSION_NAME);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:54.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=circle>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'><b><u>&lt;Projectfolder&gt;\src\main\java\com\microsoft\aad\adal4jsample\AadController.java</u></b></li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Remove following import from adal4j lib</li>
  <ul style='margin-top:0cm' type=disc>
   <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
       middle'>import com.microsoft.aad.adal4j.AuthenticationResult;</li>
  </ul>
 </ul>
</ul>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:189.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Add following import from msal4j lib</li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import com.microsoft.aad.msal4j.*;</li>
 </ul>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Add following additional imports (to support extracting claims
     from idtoken)</li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import java.io.IOException;</li>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import com.nimbusds.jwt.SignedJWT;</li>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import com.nimbusds.jwt.JWTClaimsSet;</li>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>import java.util.*;</li>
 </ul>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'>Make following code changes</li>
</ul>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 title=""
 summary="" style='margin-left:132.0pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=626 valign=top style='width:469.3pt;border:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>ADAL</p>
  </td>
  <td width=638 valign=top style='width:478.35pt;border:solid #A3A3A3 1.0pt;
  border-left:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>MSAL</p>
  </td>
 </tr>
 <tr>
  <td width=626 valign=top style='width:469.3pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>@RequestMapping(method
  = { RequestMethod.GET, RequestMethod.POST })</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    public
  String getDirectoryObjects(ModelMap model, HttpServletRequest httpRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  HttpSession session = httpRequest.getSession();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        <span
  style='background:yellow'>AuthenticationResult result = (AuthenticationResult)</span>
  session.getAttribute(AuthHelper.PRINCIPAL_SESSION_NAME);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (result == null) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  model.addAttribute(&quot;error&quot;, new
  Exception(&quot;AuthenticationResult not found in session.&quot;));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  return &quot;/error&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            String
  data;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String tenant =
  session.getServletContext().getInitParameter(&quot;tenant&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  data = getUsernamesFromGraph(result.getAccessToken(), tenant);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  model.addAttribute(&quot;tenant&quot;, tenant);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  model.addAttribute(&quot;users&quot;, data);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  <span style='background:yellow'>model.addAttribute(&quot;userInfo&quot;,
  result.getUserInfo());</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (Exception e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  model.addAttribute(&quot;error&quot;, e);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  return &quot;/error&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return &quot;/secure/aad&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
  <td width=638 valign=top style='width:478.35pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>@RequestMapping(method
  = { RequestMethod.GET, RequestMethod.POST })</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    public
  String getDirectoryObjects(ModelMap model, HttpServletRequest httpRequest) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  HttpSession session = httpRequest.getSession();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    <span
  style='background:yellow'>    IAuthenticationResult result =
  (IAuthenticationResult)</span>
  session.getAttribute(AuthHelper.PRINCIPAL_SESSION_NAME);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        if
  (result == null) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  model.addAttribute(&quot;error&quot;, new
  Exception(&quot;AuthenticationResult not found in session.&quot;));</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  return &quot;/error&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }
  else {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  String data;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  try {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  String tenant =
  session.getServletContext().getInitParameter(&quot;tenant&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  data = getUsernamesFromGraph(result.accessToken(), tenant);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>                model.addAttribute(&quot;tenant&quot;,
  tenant);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  model.addAttribute(&quot;users&quot;, data);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>             
  <span style='background:yellow'>  model.addAttribute(&quot;userInfo&quot;,
  getUserInfoFromGraph(result));</span>            </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }
  catch (Exception e) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  model.addAttribute(&quot;error&quot;, e);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>               
  return &quot;/error&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>            }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return &quot;/secure/aad&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
 <tr>
  <td width=626 valign=top style='width:469.3pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  </td>
  <td width=638 valign=top style='width:478.35pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  </td>
 </tr>
 <tr>
  <td width=626 valign=top style='width:469.3pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  </td>
  <td width=638 valign=top style='width:478.35pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>private
  JSONObject <span style='background:lime'>getUserInfoFromGraph</span>(IAuthenticationResult
  result) throws Exception {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        //
  Microsoft Graph user endpoint</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String accessToken = result.accessToken();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        URL
  url = new URL(&quot;https://graph.microsoft.com/v1.0/me&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  HttpURLConnection conn = (HttpURLConnection) url.openConnection();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        //
  Set the appropriate header fields in the request header.</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  conn.setRequestProperty(&quot;Authorization&quot;, &quot;Bearer &quot; +
  accessToken);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  conn.setRequestProperty(&quot;Accept&quot;, &quot;application/json&quot;);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String response = HttpClientHelper.getResponseStringFromConn(conn,true);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        int
  responseCode = conn.getResponseCode();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  if(responseCode != HttpURLConnection.HTTP_OK) {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  throw new IOException(response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  JSONObject responseObject = HttpClientHelper.processGoodRespStr(responseCode,
  response);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  JSONObject userObject =
  JSONHelper.fetchDirectoryObjectJSONObject(responseObject);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  SignedJWT  signedJWT = SignedJWT.parse(result.idToken());</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  JWTClaimsSet claimsSet= signedJWT.getJWTClaimsSet();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  Map&lt;String,Object&gt; myClain =claimsSet.getClaims();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  String stridp = &quot;&quot;;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  if(myClain.get(&quot;idp&quot;)!=null)</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        {</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>           
  stridp = myClain.get(&quot;idp&quot;).toString();</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        }</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>   </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>        userObject.put(&quot;identityProvider&quot;,stridp);</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>     </p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>       
  return userObject;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>    }</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:108.0pt;line-height:normal'>&nbsp;</p>

<ul style='margin-top:0cm' type=circle>
 <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
     middle'><b><u>&lt;Projectfolder&gt;\src\main\webapp\secure\aad.jsp</u></b></li>
 <ul style='margin-top:0cm' type=disc>
  <li class=MsoNormal style='margin-bottom:0cm;line-height:normal;vertical-align:
      middle'>Make following changes for jsp tags</li>
 </ul>
</ul>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 title=""
 summary="" style='margin-left:132.0pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=630 valign=top style='width:472.3pt;border:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>ADAL</p>
  </td>
  <td width=636 valign=top style='width:476.65pt;border:solid #A3A3A3 1.0pt;
  border-left:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>MSAL</p>
  </td>
 </tr>
 <tr>
  <td width=630 valign=top style='width:472.3pt;border:solid #A3A3A3 1.0pt;
  border-top:none;padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;!DOCTYPE
  html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;<a
  href="http://www.w3.org/TR/html4/loose.dtd">http://www.w3.org/TR/html4/loose.dtd</a>&quot;&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;html&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;head&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;meta
  http-equiv=&quot;Content-Type&quot; content=&quot;text/html;
  charset=UTF-8&quot;&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;title&gt;AAD
  Secure Page&lt;/title&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/head&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;body&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;h3&gt;List of users registered in
  the tenant - ${tenant}&lt;/h3&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;p&gt;${users}&lt;/p&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;br&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;h3&gt;Current user&lt;/h3&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;table&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;uniqueId:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.uniqueId}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;displayableId:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.displayableId}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;givenName:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.givenName}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;familyName:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.familyName}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;identityProvider:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.identityProvider}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;/table&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;br&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;form action=&quot;/adal4jsample&quot;&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'>&lt;input type=&quot;submit&quot;
  value=&quot;Home Page&quot;&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;/form&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/body&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/html&gt;</p>
  </td>
  <td width=636 valign=top style='width:476.65pt;border-top:none;border-left:
  none;border-bottom:solid #A3A3A3 1.0pt;border-right:solid #A3A3A3 1.0pt;
  padding:4.0pt 4.0pt 4.0pt 4.0pt'>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;!DOCTYPE
  html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;<a
  href="http://www.w3.org/TR/html4/loose.dtd">http://www.w3.org/TR/html4/loose.dtd</a>&quot;&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;html&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;head&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;meta
  http-equiv=&quot;Content-Type&quot; content=&quot;text/html;
  charset=UTF-8&quot;&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;title&gt;AAD
  Secure Page&lt;/title&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/head&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;body&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;h3&gt;List of users registered in
  the tenant - ${tenant}&lt;/h3&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;p&gt;${users}&lt;/p&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;br&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;h3&gt;Current user&lt;/h3&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;table&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;uniqueId:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.getString(&quot;id&quot;)}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;displayableId:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.getString(&quot;userPrincipalName&quot;)}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;givenName:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.getString(&quot;givenName&quot;)}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;familyName:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.getString(&quot;surname&quot;)}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;identityProvider:&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:81.0pt;line-height:normal'><span style='background:yellow'>&lt;td&gt;${userInfo.getString(&quot;identityProvider&quot;)}&lt;/td&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'><span style='background:yellow'>&lt;/tr&gt;</span></p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;/table&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;br&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;form
  action=&quot;/adal4jsample&quot;&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:54.0pt;line-height:normal'>&lt;input type=&quot;submit&quot;
  value=&quot;Home Page&quot;&gt;</p>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:27.0pt;line-height:normal'>&lt;/form&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/body&gt;</p>
  <p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&lt;/html&gt;</p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-bottom:0cm;line-height:normal'>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
